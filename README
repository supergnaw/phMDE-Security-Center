### Microsoft Defender for Endpoint Required Permissions

This table lists minimum-level permissions required for the app configuration within Microsoft Azure

|            Action             | Permission Type |        Permission         |              Display Name               |
|:-----------------------------:|:---------------:|:-------------------------:|:---------------------------------------:|
|           get alert           |   Application   |       Alert.ReadAll       |             Read all alerts             |
|       get investigation       |   Application   |      Alert.Read.All       |             Read all alerts             | 
|          list alerts          |   Application   |      Alert.Read.All       |             Read all alerts             | 
|      list investigations      |   Application   |      Alert.Read.All       |             Read all alerts             | 
|      start investigation      |   Application   |   Alerts.ReadWrite.All    |        Read and write all alerts        | 
|         update alert          |   Application   |   Alerts.ReadWrite.All    |        Read and write all alerts        | 
|      update alert batch       |   Application   |   Alerts.ReadWrite.All    |        Read and write all alerts        | 
|         get file info         |   Application   |       File.Read.All       |           Read file profiles            | 
|        get file stats         |   Application   |       File.Read.All       |           Read file profiles            | 
|       list alert files        |   Application   |       File.Read.All       |           Read file profiles            | 
|         get incident          |   Application   |     Incident.Read.All     |           Read all incidents            | 
|        list incidents         |   Application   |     Incident.Read.All     |           Read all incidents            | 
|        update incident        |   Application   |  Incident.ReadWrite.All   |      Read and write all incidents       | 
|     list library scripts      |   Application   |      Library.Manage       |      Manage live response library       | 
| collect investigation package |   Application   | Machine.CollectForensics  |            Collect forensics            | 
|        isolate machine        |   Application   |      Machine.Isolate      |             Isolate machine             | 
|       unisolate machine       |   Application   |      Machine.Isolate      |             Isolate machine             | 
|          run action           |   Application   |   Machine.LiveResponse    | Run live response on a specific machine | 
|          run actions          |   Application   |   Machine.LiveResponse    | Run live response on a specific machine | 
|          get action           |   Application   |     Machine.Read.All      |        Read all machine profiles        | 
|       get action result       |   Application   |     Machine.Read.All      |        Read all machine profiles        | 
|         list actions          |   Application   |     Machine.Read.All      |        Read all machine profiles        | 
|     list machine actions      |   Application   |     Machine.Read.All      |        Read all machine profiles        | 
|        quarantine file        |   Application   | Machine.StopAndQuarantine |           Stop And Quarantine           | 

### State File Details

The app saves a perpetual state file between runes to store things such as live response actions, authentication tokens,
and other perpetual data that is carried over between separate runs.

### Explanation of Authentication During REST Calls

The app goes through a few steps to authenticate with the Microsoft services:

```mermaid
flowchart TD
    A[Start Action] --> | No Token | B(Get New Token)
    A --> | Expired Token | B
    A --> | Current Token | C
    B --> C[Perform Actions]
    C --> |Save Token| D[End Action]
```

1. Check the state file (`self._state`) for an authentication token.
2. Verify the authentication token:
    1. If no current authentication token exists, request a new one.
    2. If current authentication token is expired, request a new one.
3. Use the new authentication token to continue API actions.
4. Save the authentication token to the state file for use on the next run.

### Port Information

The app uses HTTP/S to make REST calls to MDE. Below are the default ports used by Splunk SOAR.

| Service | Protocol | Port |
|:-------:|:--------:|:----:|
|  HTTP   |   TCP    |  80  |
|  HTTPS  |   TCP    | 443  |
